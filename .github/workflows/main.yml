name: CI
on: push
jobs:
  node-minimum:
    name: Node.js
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [ '17.x', '16.x', '15.x' '14.15.0' ]
    steps:
      - name: ➕ Actions - Checkout
        uses: actions/checkout@v2
      - name: ➕ Actions - Setup NodeJS
        uses: actions/setup-node@v2
        with:
          node-version: ${{ matrix.node-version }}
      - name: 📥 Set Local FTP
        run: docker run -d -p 21:21 -e FTP_USER=test -e FTP_PASS=test -e PASV_ADDRESS=127.0.0.1 bogem/ftp
      - run: node -v
      - name: 📦 Upgrade to the minimum required NPM version
        if: matrix.node-version == '14'
        run: npm install -g npm@7.0.2
      - name: 📦 Testing Services with FTP Connection
        run: npm run test-services
      - name: ⏪ Checking Previous Step
        run: (ls "passed" && exit 0) || exit 1
  # macos-coverage:
  #   name: macOS Coverage
  #   runs-on: macos-latest
  #   needs: [ node-16 ]
  #   steps:
  #     - name: ➕ Actions - Checkout
  #       uses: actions/checkout@v2
  #     - name: ➕ Actions - Setup NodeJS
  #       uses: actions/setup-node@v2
  #       with:
  #         node-version: '16' # Latest Node.js LTS
  #         check-latest: true
  #     - name: 📦 Testing Services
  #       run: npm run test-services
  #     - name: ⏪ Checking Previous Step
  #       run: (ls "passed" && exit 0) || exit 1
  # windows-coverage:
  #   name: Windows Coverage
  #   runs-on: windows-latest
  #   needs: [ node-16 ]
  #   steps:
  #     - name: ➕ Actions - Checkout
  #       uses: actions/checkout@v2
  #     - name: ➕ Actions - Setup NodeJS
  #       uses: actions/setup-node@v2
  #       with:
  #         node-version: '16' # Latest Node.js LTS
  #         check-latest: true
  #     - name: 📦 Testing Services
  #       run: npm run test-services
  #     - name: ⏪ Checking Previous Step
  #       run: ls "passed"; if ($?) { exit 0 } else { exit 1 }
  # publish:
  #   name: Publishing Package
  #   runs-on: ubuntu-latest
  #   needs: [ node-minimum, node-15, node-16, node-latest, macos-coverage, windows-coverage ]
  #   if: github.ref == 'refs/heads/main'
  #   steps:
  #     - name: ➕ Actions - Checkout
  #       uses: actions/checkout@v2
  #     - name: ➕ Actions - Setup NodeJS
  #       uses: actions/setup-node@v2
  #       with:
  #         node-version: '17'
  #         check-latest: true
  #         registry-url: 'https://npm.pkg.github.com'
  #         scope: '@wellwelwel'
  #     - name: 📦 Preparing Package
  #       run: node .github/workflows/publish.js
  #     - name: 📥 Publishing Package
  #       run: npm publish || exit 0
  #       env:
  #         NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}